# ğŸ”Œ å‰ç«¯ç«¯å£é…ç½®è¯´æ˜

## ğŸ“ å½“å‰ç«¯å£é…ç½®ä½ç½®

### é»˜è®¤ç«¯å£
Next.js çš„**é»˜è®¤ç«¯å£æ˜¯ 3000**ï¼Œå¦‚æœæ²¡æœ‰ç‰¹åˆ«æŒ‡å®šï¼Œå‰ç«¯æœåŠ¡ä¼šè¿è¡Œåœ¨ `http://localhost:3000`

---

## ğŸ”§ ç«¯å£é…ç½®æ–¹æ³•

### æ–¹æ³•1: ä¿®æ”¹ package.json å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰â­

**æ–‡ä»¶ä½ç½®**: `frontend/package.json`

**å½“å‰é…ç½®**:
```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start"
  }
}
```

**ä¿®æ”¹ä¸ºæŒ‡å®šç«¯å£**:
```json
{
  "scripts": {
    "dev": "next dev -p 3001",
    "build": "next build",
    "start": "next start -p 3001"
  }
}
```

**è¯´æ˜**:
- `-p 3001` æŒ‡å®šç«¯å£ä¸º 3001
- å¯ä»¥æ”¹ä¸ºä»»ä½•å¯ç”¨ç«¯å£ï¼ˆå¦‚ 3002, 3003 ç­‰ï¼‰

---

### æ–¹æ³•2: ä½¿ç”¨ç¯å¢ƒå˜é‡ PORT

**åˆ›å»ºæˆ–ç¼–è¾‘æ–‡ä»¶**: `frontend/.env.local`

**æ·»åŠ å†…å®¹**:
```env
PORT=3001
```

**æ³¨æ„**:
- Next.js ä¼šè‡ªåŠ¨è¯»å– `PORT` ç¯å¢ƒå˜é‡
- å¦‚æœåŒæ—¶è®¾ç½®äº† `-p` å‚æ•°å’Œç¯å¢ƒå˜é‡ï¼Œ`-p` å‚æ•°ä¼˜å…ˆçº§æ›´é«˜

---

### æ–¹æ³•3: åœ¨å¯åŠ¨å‘½ä»¤ä¸­ä¸´æ—¶æŒ‡å®š

**ä¸´æ—¶æŒ‡å®šç«¯å£**ï¼ˆä¸ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼‰:
```bash
# åœ¨ frontend ç›®å½•ä¸‹
npm run dev -- -p 3001

# æˆ–ä½¿ç”¨æ ¹ç›®å½•è„šæœ¬
npm run dev:frontend -- -p 3001
```

**è¯´æ˜**:
- `--` åé¢çš„å‚æ•°ä¼šä¼ é€’ç»™ `next dev` å‘½ä»¤
- åªå½±å“æœ¬æ¬¡å¯åŠ¨ï¼Œä¸ä¼šä¿®æ”¹é…ç½®æ–‡ä»¶

---

## ğŸ“ å®Œæ•´é…ç½®ç¤ºä¾‹

### ç¤ºä¾‹1: ä¿®æ”¹ä¸ºç«¯å£ 3001

**æ­¥éª¤1**: ä¿®æ”¹ `frontend/package.json`

```json
{
  "scripts": {
    "dev": "next dev -p 3001",
    "build": "next build",
    "start": "next start -p 3001"
  }
}
```

**æ­¥éª¤2**: å¦‚æœä½¿ç”¨æ ¹ç›®å½•å¯åŠ¨è„šæœ¬ï¼Œä¹Ÿéœ€è¦ä¿®æ”¹ `package.json`

```json
{
  "scripts": {
    "dev": "concurrently \"npm run dev:backend\" \"npm run dev:frontend\"",
    "dev:backend": "cd backend && npm run dev",
    "dev:frontend": "cd frontend && npm run dev -p 3001"
  }
}
```

**æ­¥éª¤3**: æ›´æ–°å‰ç«¯ç¯å¢ƒå˜é‡ï¼ˆå¦‚æœéœ€è¦ï¼‰

åˆ›å»ºæˆ–ç¼–è¾‘ `frontend/.env.local`:
```env
PORT=3001
NEXT_PUBLIC_API_URL=http://localhost:5000/api
```

---

### ç¤ºä¾‹2: ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®

**åˆ›å»º `frontend/.env.local`**:
```env
PORT=3001
NEXT_PUBLIC_API_URL=http://localhost:5000/api
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_your_stripe_publishable_key
```

**ä¿æŒ `frontend/package.json` ä¸å˜**:
```json
{
  "scripts": {
    "dev": "next dev"
  }
}
```

Next.js ä¼šè‡ªåŠ¨è¯»å– `PORT` ç¯å¢ƒå˜é‡ã€‚

---

## ğŸ” ç«¯å£é…ç½®ä¼˜å…ˆçº§

ç«¯å£è®¾ç½®çš„ä¼˜å…ˆçº§ï¼ˆä»é«˜åˆ°ä½ï¼‰ï¼š

1. **å‘½ä»¤è¡Œå‚æ•°** (`-p 3001`) - æœ€é«˜ä¼˜å…ˆçº§
2. **ç¯å¢ƒå˜é‡** (`PORT=3001`) - ä¸­ç­‰ä¼˜å…ˆçº§
3. **é»˜è®¤ç«¯å£** (`3000`) - æœ€ä½ä¼˜å…ˆçº§

---

## âš™ï¸ ç›¸å…³é…ç½®æ–‡ä»¶ä½ç½®

### 1. å‰ç«¯å¯åŠ¨è„šæœ¬
**æ–‡ä»¶**: `frontend/package.json`
```json
{
  "scripts": {
    "dev": "next dev -p 3000"  // åœ¨è¿™é‡Œæ·»åŠ  -p å‚æ•°
  }
}
```

### 2. æ ¹ç›®å½•å¯åŠ¨è„šæœ¬
**æ–‡ä»¶**: `package.json` (é¡¹ç›®æ ¹ç›®å½•)
```json
{
  "scripts": {
    "dev:frontend": "cd frontend && npm run dev -p 3000"  // åœ¨è¿™é‡Œæ·»åŠ  -p å‚æ•°
  }
}
```

### 3. ç¯å¢ƒå˜é‡æ–‡ä»¶
**æ–‡ä»¶**: `frontend/.env.local`
```env
PORT=3000
```

---

## ğŸš€ ä¿®æ”¹ç«¯å£åçš„å®Œæ•´æµç¨‹

### åœºæ™¯ï¼šå°†ç«¯å£ä» 3000 æ”¹ä¸º 3001

**æ­¥éª¤1**: ä¿®æ”¹ `frontend/package.json`
```json
{
  "scripts": {
    "dev": "next dev -p 3001"
  }
}
```

**æ­¥éª¤2**: ä¿®æ”¹æ ¹ç›®å½• `package.json`ï¼ˆå¦‚æœä½¿ç”¨ç»Ÿä¸€å¯åŠ¨ï¼‰
```json
{
  "scripts": {
    "dev:frontend": "cd frontend && npm run dev -p 3001"
  }
}
```

**æ­¥éª¤3**: æ›´æ–°å‰ç«¯ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰
åˆ›å»º `frontend/.env.local`:
```env
PORT=3001
NEXT_PUBLIC_API_URL=http://localhost:5000/api
```

**æ­¥éª¤4**: é‡å¯æœåŠ¡
```bash
npm run dev
```

**æ­¥éª¤5**: è®¿é—®æ–°ç«¯å£
- å‰ç«¯: `http://localhost:3001`
- åç«¯: `http://localhost:5000` (ä¸å˜)

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç«¯å£å†²çª

å¦‚æœç«¯å£è¢«å ç”¨ï¼ŒNext.js ä¼šæ˜¾ç¤ºé”™è¯¯ï¼š
```
Error: listen EADDRINUSE: address already in use :::3000
```

**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨å…¶ä»–ç«¯å£ï¼ˆå¦‚ 3001, 3002ï¼‰
- æˆ–ç»“æŸå ç”¨ç«¯å£çš„è¿›ç¨‹

### 2. åç«¯ CORS é…ç½®

å¦‚æœä¿®æ”¹äº†å‰ç«¯ç«¯å£ï¼Œéœ€è¦ç¡®ä¿åç«¯å…è®¸æ–°ç«¯å£çš„è·¨åŸŸè¯·æ±‚ã€‚

**æ£€æŸ¥æ–‡ä»¶**: `backend/src/server.js`
```javascript
const io = socketIo(server, {
  cors: {
    origin: process.env.FRONTEND_URL || "http://localhost:3000",  // æ›´æ–°è¿™é‡Œ
    methods: ["GET", "POST"]
  }
});
```

**æ›´æ–°åç«¯ç¯å¢ƒå˜é‡**: `backend/.env`
```env
FRONTEND_URL=http://localhost:3001
```

### 3. å‰ç«¯ API é…ç½®

å‰ç«¯ç«¯å£æ”¹å˜ä¸å½±å“ API è°ƒç”¨ï¼Œå› ä¸º API åœ°å€é…ç½®åœ¨ï¼š
- `frontend/.env.local` ä¸­çš„ `NEXT_PUBLIC_API_URL`
- `frontend/src/lib/api.ts` ä¸­çš„ `baseURL`

è¿™äº›é…ç½®æŒ‡å‘åç«¯ç«¯å£ï¼ˆé»˜è®¤ 5000ï¼‰ï¼Œä¸å‰ç«¯ç«¯å£æ— å…³ã€‚

---

## ğŸ“‹ å¿«é€Ÿå‚è€ƒ

### æŸ¥çœ‹å½“å‰ç«¯å£é…ç½®

```bash
# æŸ¥çœ‹ package.json ä¸­çš„å¯åŠ¨è„šæœ¬
cat frontend/package.json | grep "dev"

# æŸ¥çœ‹ç¯å¢ƒå˜é‡æ–‡ä»¶
cat frontend/.env.local
```

### ä¿®æ”¹ç«¯å£ä¸º 3001

**æ–¹æ³•1ï¼ˆæ¨èï¼‰**: ä¿®æ”¹ `frontend/package.json`
```json
"dev": "next dev -p 3001"
```

**æ–¹æ³•2**: åˆ›å»º `frontend/.env.local`
```env
PORT=3001
```

**æ–¹æ³•3**: ä¸´æ—¶æŒ‡å®š
```bash
npm run dev -- -p 3001
```

---

## ğŸ¯ æ¨èé…ç½®

### å¼€å‘ç¯å¢ƒæ¨è

**ä½¿ç”¨é»˜è®¤ç«¯å£ 3000**ï¼ˆå¦‚æœå¯ç”¨ï¼‰:
- ç®€å•ï¼Œæ— éœ€é¢å¤–é…ç½®
- ç¬¦åˆ Next.js æƒ¯ä¾‹

**å¦‚æœ 3000 è¢«å ç”¨ï¼Œä½¿ç”¨ 3001**:
```json
// frontend/package.json
{
  "scripts": {
    "dev": "next dev -p 3001"
  }
}
```

### ç”Ÿäº§ç¯å¢ƒ

ç”Ÿäº§ç¯å¢ƒé€šå¸¸ä½¿ç”¨åå‘ä»£ç†ï¼ˆå¦‚ Nginxï¼‰ï¼Œç«¯å£é…ç½®åœ¨æœåŠ¡å™¨å±‚é¢ï¼Œä¸éœ€è¦åœ¨ Next.js ä¸­æŒ‡å®šã€‚

---

## âœ… æ£€æŸ¥æ¸…å•

ä¿®æ”¹ç«¯å£åï¼Œç¡®è®¤ä»¥ä¸‹äº‹é¡¹ï¼š

- [ ] `frontend/package.json` ä¸­çš„ `dev` è„šæœ¬å·²æ›´æ–°
- [ ] æ ¹ç›®å½• `package.json` ä¸­çš„ `dev:frontend` è„šæœ¬å·²æ›´æ–°ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
- [ ] `frontend/.env.local` ä¸­çš„ `PORT` å·²è®¾ç½®ï¼ˆå¦‚æœä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰
- [ ] åç«¯ `backend/.env` ä¸­çš„ `FRONTEND_URL` å·²æ›´æ–°ï¼ˆå¦‚æœä¿®æ”¹äº†ç«¯å£ï¼‰
- [ ] ç«¯å£æœªè¢«å…¶ä»–ç¨‹åºå ç”¨
- [ ] æœåŠ¡å¯ä»¥æ­£å¸¸å¯åŠ¨
- [ ] æµè§ˆå™¨å¯ä»¥è®¿é—®æ–°ç«¯å£

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Next.js å®˜æ–¹æ–‡æ¡£ - ç«¯å£é…ç½®](https://nextjs.org/docs/api-reference/cli#development)
- [Next.js ç¯å¢ƒå˜é‡](https://nextjs.org/docs/basic-features/environment-variables)

---

å¸Œæœ›è¿™ä»½æŒ‡å—èƒ½å¸®åŠ©æ‚¨é…ç½®å‰ç«¯ç«¯å£ï¼ğŸš€

